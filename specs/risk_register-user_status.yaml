# Risk Register: user_status Module

# Version: 1.0.0
# Date: 2025-01-17
# Epic: Epic-21 - User Management

metadata:
  module: "user_status"
  complexity: "simple"
  estimated_effort: "2-3 hours"
  risk_level: "LOW"
  
summary:
  total_risks: 5
  by_severity:
    CRITICAL: 0
    HIGH: 0
    MEDIUM: 1
    LOW: 4
  by_status:
    OPEN: 1
    MITIGATED: 4
    BLOCKER: 0
  by_type:
    API: 0
    DEPENDENCY: 0
    IMPLEMENTATION: 1
    QUALITY: 2
    SCHEDULE: 2

risks:
  # API Risks
  # None - simple enum with well-defined TL schema
  
  # Dependency Risks
  # None - zero internal dependencies, one optional external
  
  # Implementation Risks
  - id: "R1"
    type: "IMPLEMENTATION"
    title: "Time-sensitive logic in is_online_now()"
    description: |
      The is_online_now() helper method needs to compare the current time
      with the expires field. This introduces non-deterministic behavior in tests
      and could be confusing if not handled carefully.
    status: "MITIGATED"
    probability: "MEDIUM"
    impact: "LOW"
    severity: "LOW"
    mitigation:
      - "Document clearly that is_online_now() is time-sensitive"
      - "Provide tests that use fixed timestamps"
      - "Consider adding a parameter-based version: is_online_at(timestamp)"
      - "Mark as #[cfg(test)] for deterministic testing"
    owner: "developer"
    due_date: "2025-01-17"
    
  # Quality Risks
  - id: "R2"
    type: "QUALITY"
    title: "Achieving 30+ tests for simple enum"
    description: |
      The success criterion requires >=30 tests, but the enum only has 6 variants.
      This requires creative test categorization to avoid redundant tests.
    status: "MITIGATED"
    probability: "LOW"
    impact: "LOW"
    severity: "LOW"
    mitigation:
      - "Use proven test structure from emoji_group_type (26 tests for 4 variants)"
      - "Separate tests into: trait implementations, variant checks, field accessors, conversions, helpers, edge cases"
      - "Test each privacy flag combination (Recently/LastWeek/LastMonth Ã— true/false)"
      - "Test edge cases: timestamps at boundaries, negative timestamps, i32::MAX/MIN"
      - "Include serde tests when feature is enabled"
    owner: "developer"
    due_date: "2025-01-17"
    
  - id: "R3"
    type: "QUALITY"
    title: "Clippy warnings for enum representation"
    description: |
      Using #[repr(i32)] on an enum with variants containing different data types
      could trigger clippy warnings about enum size or representation.
    status: "MITIGATED"
    probability: "LOW"
    impact: "LOW"
    severity: "LOW"
    mitigation:
      - "All variants use Copy types (i32, bool, unit)"
      - "Enum size is predictable: 8 bytes (discriminant + largest field)"
      - "#[repr(i32)] is required for FFI compatibility with TDLib"
      - "Suppress specific warnings if needed with #[allow(...)]"
      - "Verify with cargo clippy -p rustgram-user-status"
    owner: "developer"
    due_date: "2025-01-17"
    
  # Schedule Risks
  - id: "R4"
    type: "SCHEDULE"
    title: "Time required for comprehensive testing"
    description: |
      Writing 30+ tests for a simple enum takes more time than the implementation itself.
      This could make the module seem slower to implement than expected.
    status: "OPEN"
    probability: "MEDIUM"
    impact: "LOW"
    severity: "LOW"
    mitigation:
      - "Use test generation macro for repetitive tests"
      - "Copy test structure from emoji_group_type (proven pattern)"
      - "Focus on high-value tests first (variant creation, conversions)"
      - "Edge case tests can be added incrementally"
      - "Target 2-3 hours for implementation, 1-2 hours for tests"
    owner: "developer"
    due_date: "2025-01-17"
    
  - id: "R5"
    type: "SCHEDULE"
    title: "TDLib reference verification overhead"
    description: |
      Need to verify behavior against TDLib for all 6 variants, including:
      - Privacy flag semantics
      - Timestamp handling
      - Default variant choice
    status: "MITIGATED"
    probability: "LOW"
    impact: "LOW"
    severity: "LOW"
    mitigation:
      - "TL schema is unambiguous and complete"
      - "Privacy flag behavior is straightforward (bool, no special logic)"
      - "Timestamps are standard Unix timestamps (i32)"
      - "Can defer TDLib behavioral verification to integration tests"
      - "Unit tests focus on Rust correctness, not TDLib behavior"
    owner: "developer"
    due_date: "2025-01-17"

next_actions:
  - priority: "HIGH"
    action: "Implement R1 mitigation - add time parameter variant for testing"
    assignee: "developer"
    due: "2025-01-17"
    
  - priority: "HIGH"
    action: "Create test checklist based on emoji_group_type structure"
    assignee: "developer"
    due: "2025-01-17"
    
  - priority: "MEDIUM"
    action: "Verify clippy compliance after implementation"
    assignee: "developer"
    due: "2025-01-17"
