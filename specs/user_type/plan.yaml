# Execution Plan: UserType Module Implementation
# Epic: rustgram-client-bz7
# Phase: 2 - Implementation
# Generated: 2026-01-17

plan:
  title: "Implement UserType enum with 4 variants"
  complexity: LOW
  estimated_loc: 300-400
  estimated_tests: 35
  module_type: "Data Enum"

  tdlib_reference:
    file: "references/td/td/generate/scheme/td_api.tl"
    lines: 658-681
    class: "UserType"

  target_crate:
    name: "rustgram-user-type"
    path: "crates/user_type/"

  variants:
    - name: "Regular"
      tl_name: "userTypeRegular"
      fields: []
      description: "A regular user"
      default: true

    - name: "Deleted"
      tl_name: "userTypeDeleted"
      fields: []
      description: "A deleted user or deleted bot. No information available."
      default: false

    - name: "Bot"
      tl_name: "userTypeBot"
      fields:
        - { name: "can_be_edited", type: "bool", description: "Bot can be edited by owner" }
        - { name: "can_join_groups", type: "bool", description: "Bot can be invited to groups" }
        - { name: "can_read_all_group_messages", type: "bool", description: "Bot can read all group messages" }
        - { name: "has_main_web_app", type: "bool", description: "Bot has main Web App" }
        - { name: "has_topics", type: "bool", description: "Bot has topics" }
        - { name: "is_inline", type: "bool", description: "Bot supports inline queries" }
        - { name: "inline_query_placeholder", type: "String", description: "Placeholder for inline queries" }
        - { name: "need_location", type: "bool", description: "Location expected with inline queries" }
        - { name: "can_connect_to_business", type: "bool", description: "Bot supports Business accounts" }
        - { name: "can_be_added_to_attachment_menu", type: "bool", description: "Bot can be added to attachment menu" }
        - { name: "active_user_count", type: "i32", description: "Number of recently active users" }
      description: "A bot (see https://core.telegram.org/bots)"
      default: false

    - name: "Unknown"
      tl_name: "userTypeUnknown"
      fields: []
      description: "No information available, rare, handle like deleted"
      default: false

  implementation_steps:
    - id: 1
      name: "Define enum with variants"
      agent: "agent-dev-rust"
      description: |
        Define the UserType enum with all 4 variants. Bot variant should be
        a struct-like variant with all 11 fields. Add proper derives.
      depends_on: []
      acceptance:
        - "Enum compiles with all 4 variants"
        - "Bot variant has all 11 fields with correct types"
        - "All required derives present (Debug, Clone, Copy, PartialEq, Eq, Hash, Default, Serialize, Deserialize)"
        - "UserType::Regular is the default variant"

    - id: 2
      name: "Implement conversion methods"
      agent: "agent-dev-rust"
      description: |
        Implement from_td_api_name(), to_td_api_name(), from_i32(), to_i32()
        following patterns from emoji_group_type crate.
      depends_on: [1]
      acceptance:
        - "from_td_api_name('userTypeRegular') returns UserType::Regular"
        - "from_td_api_name('userTypeBot') returns appropriate variant"
        - "to_td_api_name() returns correct TL schema strings"
        - "Invalid inputs return None/Unknown appropriately"

    - id: 3
      name: "Implement Display trait"
      agent: "agent-dev-rust"
      description: "Implement Display trait for human-readable output"
      depends_on: [1]
      acceptance:
        - "format!(\"{}\", UserType::Regular) returns 'Regular'"
        - "All variants have readable names"

    - id: 4
      name: "Implement convenience methods"
      agent: "agent-dev-rust"
      description: |
        Implement helper methods: is_bot(), is_deleted(), is_regular(),
        and getters for Bot variant fields.
      depends_on: [1]
      acceptance:
        - "is_bot() returns true only for Bot variant"
        - "is_deleted() returns true for Deleted variant"
        - "Bot variant has getters for all 11 fields"
        - "Regular/Deleted/Unknown return sensible defaults for Bot getters"

    - id: 5
      name: "Write unit tests"
      agent: "agent-dev-rust"
      description: "Write comprehensive unit tests covering all methods"
      depends_on: [1, 2, 3, 4]
      acceptance:
        - ">= 35 tests total"
        - "All variants tested"
        - "All conversion methods tested"
        - "Edge cases covered (invalid inputs, etc.)"

    - id: 6
      name: "Code review"
      agent: "agent-reviewer"
      description: "Review implementation for style, correctness, and completeness"
      depends_on: [5]
      acceptance:
        - "Zero clippy warnings"
        - "All public items have doc comments"
        - "Code follows project conventions"

    - id: 7
      name: "Documentation"
      agent: "agent-docs"
      description: "Update module-level documentation"
      depends_on: [6]
      acceptance:
        - "Module doc explains UserType purpose"
        - "Examples provided for common usage"
        - "TDLib reference documented"

  dependencies:
    external:
      - crate: "serde"
        version: "1.0"
        features: ["derive"]
        used_for: "Serialization support"

    internal: []  # No internal dependencies

  testing_strategy:
    unit_tests:
      target: 35
      breakdown:
        enum_construction: 4
        conversion_methods: 12
        display_trait: 4
        convenience_methods: 8
        edge_cases: 4
        serialization: 3

    integration_tests: 0  # Pure data type, no integration needed

    doc_tests:
      target: 5
      focus: "Common usage patterns"

  risk_mitigation:
    - risk: "11-field Bot variant may have ergonomic issues"
      mitigation: "Consider builder pattern in Phase 2 if needed"
      priority: "low"

    - risk: "TL schema name mismatches"
      mitigation: "Verify against td_api.tl in review"
      priority: "low"
