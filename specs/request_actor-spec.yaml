# Specification: RequestActor
module: request_actor
crate: rustgram-request-actor
tdlib_reference: references/td/td/telegram/RequestActor.h
complexity: HIGH
module_type: Manager Type (Actor)
estimated_loc: 800-1200
estimated_tests: 50-70

types:
  - name: RequestActor
    description: |
      Generic actor for handling async requests.
      
      Base actor type that handles async requests with retry logic.
      Manages promise/future pairs and handles request completion or failure.
      Template parameter T specifies the result type.
    fields:
      - name: td_id
        type: ActorShared<Td>
        description: Shared actor reference to Td
        optional: false
      - name: td
        type: *mut Td
        description: Raw pointer to Td (unsafe)
        optional: false
      - name: request_id
        type: u64
        description: Request ID for tracking
        optional: false
      - name: tries_left
        type: i32
        description: Number of retry attempts remaining
        optional: false
      - name: future
        type: FutureActor<T>
        description: Pending future for the request
        optional: true

  - name: RequestOnceActor
    description: |
      Actor that runs only once without retry.
      
      Simplified version of RequestActor that doesn't retry.
      Suitable for idempotent operations.

external_dependencies:
  - type: Td
    crate: rustgram-td
    verified: false # STUB NEEDED
  - type: ActorShared
    crate: rustgram-actor
    verified: false # STUB NEEDED
  - type: Promise
    crate: rustgram-promise
    verified: false # STUB NEEDED
  - type: FutureActor
    crate: rustgram-future
    verified: false # STUB NEEDED

constructors:
  - name: new
    description: Creates new RequestActor
    parameters:
      - name: td_id
        type: ActorShared<Td>
      - name: request_id
        type: u64
    returns: Self

methods (protected):
  - name: send_result
    description: Sends result to client
  - name: send_error
    description: Sends error to client

methods (public):
  - name: get_tries
    description: Gets remaining retry count
    returns: i32
  - name: set_tries
    description: Sets retry count
    parameters:
      - name: tries
        type: i32

traits:
  - Actor (custom trait)

test_plan:
  unit_tests: 50
  doc_tests: 8

notes: |
  This is a complex actor type that relies on the TDLib actor framework.
  For Rust, we'll need to:
  1. Create simplified Actor trait
  2. Create Promise/Future infrastructure
  3. Handle async request lifecycle
  
  The unsafe raw pointer to Td is concerning - in Rust, use Arc<Td>
  or references instead.
  
  Default tries_left is 2 (one initial attempt + one retry).
  When tries_left reaches 0, the request is cancelled with error 500.
